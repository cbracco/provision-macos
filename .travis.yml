sudo: required
language: objective-c
# Test multiple versions of macOS
# https://docs.travis-ci.com/user/reference/osx/#OS-X-Version
matrix:
  include:
    # High Sierra (10.13)
    - os: osx
      osx_image: xcode9.3
    # Sierra (10.12)
    - os: osx
      osx_image: xcode9.2

before_install:
  # Uninstall existing Homebrew installation.
  - curl -sLO https://raw.githubusercontent.com/Homebrew/install/master/uninstall
  - chmod +x ./uninstall
  - ./uninstall --force
  - sudo rm -rf /usr/local/Homebrew
  - sudo rm -rf /usr/local/Caskroom
  - sudo rm -rf /usr/local/bin/brew

install:
  # Install homebrew
  - /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  # Install Python via homebrew
  - brew install python
  # Update pip to avoid TLS errors in macOS Sierra 10.12 and older
  # https://stackoverflow.com/a/49748494
  - macos_version=$(sw_vers -productVersion)
  - |
    if [[ "$macos_version" == 10.13.* ]]; then
      sudo easy_install pip
    else
      # See: https://stackoverflow.com/a/49748494/100134
      curl https://bootstrap.pypa.io/get-pip.py | sudo python
    fi
  - pip install --upgrade setuptools
  # Install Ansible via pip
  - sudo -H pip install ansible

script:
  # Check playbook syntax
  - ansible-playbook tests/test.yml --syntax-check
  # Run the playbook
  - ansible-playbook tests/test.yml
